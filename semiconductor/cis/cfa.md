# CFA

CFA (Color Filter Array, 色彩滤波阵列), 也称作 CMOS 色彩滤镜

1. **Bayer Color Filter Array (BCFA)**:

    - **原理**: BCFA 包括红色、绿色和蓝色滤波器，它们以 2x2 的重复模式排列在图像传感器上. 每个像素只能接收其中一种颜色的光，通过插值算法生成完整的彩色图像.
    - **优点**: 成本低、易于实现、广泛应用.
    - **缺点**: 可能会引入彩色伪影和降低分辨率.
    - **实际应用**: 绝大多数消费级和专业摄像设备中使用，如手机摄像头、数码相机等.

    是最常用的 CFA, 俗称 "马赛克传感器", 由一行 RGRGRG..., 一行 BGBGBG...交错排列形成, 每一个像素点都只能读取单独的颜色信息, 其中绿色像素的采样频率是输出像素的 1/2, 红/蓝色像素采样频率是输出像素的 1/4, 所以用 BCFA 的传感器的分辨率是由绿色像素决定的

    BFCA 采样后要经过反马赛克运算 (每个 2x2 像素经过 9 次矩阵运算, 也是种线性计算) 才可以输出为全色彩图像

    BFCA 存在欠采样的问题, 因为会出现摩尔纹和伪色 (摩尔纹出现时因为输入信号的最高频率成分超过了传感器的奈奎斯特极限, 也就是说传感器的高频采样能力存在一些不足)

    虽然有图像质量的问题, 但因为结构简单, 所以只要 BCFA 底下的光电二极管能跟上, 分分钟就能上亿像素几百张图, 也就是暴力堆砌, 感觉适用非消费级产品

2. **RGBE Filter Array**:

    - **原理**: RGBE 阵列包括红色、绿色、蓝色和透明 (Clear) 滤波器，透明滤波器用于捕获更多的光信息.
    - **优点**: 提供更好的光线捕获能力.
    - **缺点**: 可能需要更复杂的处理算法.
    - **实际应用**: 用于一些专业摄像设备和科学应用中.

3. **CYGM Filter Array**:

    - **原理**: CYGM 阵列包括青色、黄色、绿色和品红色滤波器，提供更广泛的色彩范围.
    - **优点**: 能够捕获更多的颜色信息.
    - **缺点**: 可能需要更复杂的处理算法.
    - **实际应用**: 在某些专业应用中可能会使用.

4. **X-Trans Filter Array**:

    - **原理**: X-Trans 阵列采用一种不规则排列方式，有助于减少颜色伪影并提高图像质量.
    - **优点**: 提高图像质量、减少颜色伪影.
    - **缺点**: 设计和处理可能更复杂，成本可能较高.
    - **实际应用**: 由富士胶片开发，用于一些高端相机中，提供更好的图像质量和细节表现.

    每一组 X-Trans (6x6 像素为一组)中都在中央包含 2x2 纯绿像素块, 而这 2x2 中的每一个 1x1 都可以和它三个角上的像素块拼成 2x2, 所以不是"无序性"的, 在高频的采样能力上优于 BCFA, X-Trans CMOS 能在不用低通 (Low-pass filter) 的前提下规避摩尔纹

    每个 6×6 子像素当中会有分布较离散的 4 个绿色子像素, 这部分的采样频率低于传统的拜耳阵列, 绿色像素采样输出 1/9, 低于 BFCA 的 1/2, 红色/蓝色像素排列比较特殊, 等采样频率下输出像素 2/9, 与 BCFA 的 1/4 略低但相差不大

    这种排列方式就是"大小核"的思路, 采用 2×2 的高频采样模块来处理高频信息, 1/9 的低频模块来处理中低频信息, 同时保证红蓝像素的采样率基本不变. 但是 1 和 1/9 两种采样频率之间的差异实在是太大，中高频的信息势必会有一些损失

    胶片没有摩尔纹的原因其实也无关什么无序性，胶片是全色采样，类似 X3, 输出时 1:1, 所以 X-Trans 也可以叫 "仿生胶片传感器", X-Trans 还有一个问题就是解码算法远比 BCFA 来得复杂

5. **Foveon X3**:

    - **原理**: Foveon X3 传感器采用垂直色彩分离技术，通过在不同深度上分层排列红、绿、蓝色滤波器来捕获彩色信息.
    - **优点**: 相比传统 CFA，Foveon X3 传感器可以更准确地捕获颜色信息，因为每个像素都能同时获取红、绿、蓝三种颜色的信息.
    - **缺点**: 在高 ISO 情况下可能存在噪点问题，对光线敏感度较高.
    - **实际应用**: 用于 Sigma 相机中，提供较为准确的颜色还原.

    这种时 1:1 的采样, 拍摄色彩丰富的纹理图案时细节表现出色

    但是缺点很明显, 他是 3 层堆栈架构, 且 3 层之间距离大, 信号通路不可能用 TSV (硅片上穿孔), 而只能引出布线, 数字信号输出 (内置 ADC) 更不可能, 所以这种 CMOS 传输的噪声很高, 连 ISP 来调整 ISO 会导致整体电路层设计性能堪忧, 后来 Sigma/Foveon 自己都妥协了，DP Q 系列相机采用了新的 4:1:1 Quattro X3 传感器

6. **Quattro X3 传感器**
    - **原理**: Quattro X3 传感器是 Foveon X3 传感器的改进版本，采用了新的排列方式和结构设计.
    - **优点**:
        - 提高了像素密度和分辨率，有助于提高细节表现和图像质量
        - 改进了噪点和光线敏感度问题，提升了高 ISO 性能
    - **缺点**: 相比传统 Foveon X3 传感器，可能会有更高的处理复杂度和成本
    - **实际应用**: 用于 Sigma 相机中，提供更好的图像质量和性能

这些彩色滤波器阵列类型在不同的应用和场景中具有各自的优势和特点，选择合适的 CFA 类型取决于具体的需求和应用场景.

@see: https://zhuanlan.zhihu.com/p/21298545
@see: https://zhuanlan.zhihu.com/p/42188821
